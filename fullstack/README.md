# Full Stack DevContainer with SQL Server

A comprehensive DevContainer setup for full-stack development with .NET, Node.js, and SQL Server.

## Features

- **Multi-Service Setup**: Application container with SQL Server database
- **Comprehensive Tooling**: .NET SDK, Node.js LTS, SQL Server tools
- **SSH Integration**: Automated SSH key setup for Git operations
- **Enhanced Error Handling**: Clear error messages and graceful degradation
- **Validation Tools**: Built-in setup validation and troubleshooting

## Quick Start

1. **Clone and Open**: Open this folder in VS Code
2. **Reopen in Container**: Use "Dev Containers: Reopen in Container"
3. **Wait for Setup**: The container will automatically set up all components
4. **Validate Setup**: Run `./.devcontainer/scripts/validate-setup.sh` to verify everything is working

## Setup Components

### Automatic Setup
The DevContainer automatically configures:
- âœ… SSH keys and Git integration
- âœ… Node.js LTS with npm
- âœ… SQL Server connectivity testing
- âœ… Development tools and extensions

### SSH Key Configuration
To enable Git operations with SSH:

1. **Run the SSH setup script**:
   ```bash
   ./.devcontainer/setup-ssh-dotenv.sh
   ```

2. **Follow the prompts** to add your SSH keys

3. **Rebuild the container** to apply the changes

### Environment Variables
Configure these in `.devcontainer/.env`:

```env
# SQL Server Configuration
MSSQL_SA_PASSWORD=YourStrongPassword123!

# SSH Keys (auto-generated by setup script)
SSH_PRIVATE_KEY_B64=<base64-encoded-private-key>
SSH_PUBLIC_KEY_B64=<base64-encoded-public-key>
```

## Development Workflow

### Database Development
- SQL Server runs automatically in a separate container
- Connection details are pre-configured in VS Code
- Use the SQL Server extension for database management

### Full Stack Development
- **Backend**: .NET development with full SDK support
- **Frontend**: Node.js development with latest LTS
- **Database**: SQL Server with development tools

## Troubleshooting

### Setup Validation
Run the validation script to check your setup:
```bash
./.devcontainer/scripts/validate-setup.sh
```

### Common Issues

**SSH Keys Not Working**
```bash
# Re-run the SSH setup
./.devcontainer/setup-ssh-dotenv.sh

# Rebuild the container
# Ctrl+Shift+P -> "Dev Containers: Rebuild Container"
```

**SQL Server Connection Failed**
```bash
# Check if SA password is set
cat .devcontainer/.env | grep MSSQL_SA_PASSWORD

# Test connection manually
sqlcmd -S localhost -U sa -P "YourPassword"
```

**Node.js Issues**
```bash
# Check Node.js installation
node --version
npm --version

# Reinstall if needed
nvm install --lts
```

### Error Logs
All setup activities are logged with clear, color-coded messages:
- ðŸ”µ **INFO**: General information
- ðŸŸ¢ **SUCCESS**: Successful operations  
- ðŸŸ¡ **WARNING**: Non-critical issues (container still functional)
- ðŸ”´ **ERROR**: Critical failures (may need attention)

### Manual Setup Recovery
If automatic setup fails, you can run components manually:

```bash
# Run comprehensive setup
./.devcontainer/scripts/post-create-setup.sh

# Or run specific components
bash ./.devcontainer/scripts/post-create-setup.sh

# Validate the setup
./.devcontainer/scripts/validate-setup.sh
```

## File Structure

```
.devcontainer/
â”œâ”€â”€ devcontainer.json          # Container configuration
â”œâ”€â”€ docker-compose.yml         # Multi-service setup
â”œâ”€â”€ Dockerfile                 # Container image definition
â”œâ”€â”€ .env                       # Environment variables
â”œâ”€â”€ setup-ssh-dotenv.sh       # SSH key setup helper
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ post-create-setup.sh   # Single comprehensive setup script
â”‚   â”œâ”€â”€ validate-setup.sh      # Setup validation
â”‚   â”œâ”€â”€ installSQLtools.sh     # SQL tools installation
â”‚   â””â”€â”€ README.md              # Scripts documentation
```

## Advanced Configuration

### Custom Database Projects
The setup supports custom database project paths via the `postCreateCommand` parameter in `devcontainer.json`.

### Additional Node.js Versions
To install additional Node.js versions:
```bash
nvm install 18  # Install specific version
nvm use 18      # Switch to version
```

### SSH Configuration
The setup automatically configures SSH for common Git providers:
- GitHub
- GitLab  
- Bitbucket
- Azure DevOps

## Support

For issues or questions:
1. Check the validation script output
2. Review the setup logs
3. Consult the scripts README: `.devcontainer/scripts/README.md`
4. Check individual script documentation

The setup is designed to be resilient and continue working even if some components fail, providing clear feedback about any issues.
